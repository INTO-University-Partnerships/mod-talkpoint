!function e(n,t,i){function o(r,m){if(!t[r]){if(!n[r]){var l="function"==typeof require&&require;if(!m&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=t[r]={exports:{}};n[r][0].call(u.exports,function(e){var t=n[r][1][e];return o(t?t:e)},u,u.exports,e,n,t,i)}return t[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,n,t){"use strict";var i=angular.module("talkpointsApp",["talkpointsApp.controllers","talkpointsApp.services","talkpointsApp.directives","ngSanitize"]);i.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://player.nimbb.com/**","https://player.nimbb.com/**","http://api.nimbb.com/**","https://api.nimbb.com/**"])}]),i.constant("NIMBB_PUBLIC_KEY","c7d8097faa"),i.constant("NIMBB_SWF_URL","https://player.nimbb.com/nimbb.swf"),i.constant("CONFIG",window.CONFIG),delete window.CONFIG},{}],2:[function(e,n,t){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("./services")},{"./angular-app":1,"./controllers":3,"./directives":4,"./services":5}],3:[function(e,n,t){"use strict";var i=angular.module("talkpointsApp.controllers",[]);i.controller("talkpointCtrl",["$scope","$timeout","$window","talkpointsSrv","commentsSrv","CONFIG",function(e,n,t,i,o,a){e.talkpoint=null,e.comments=null,e.commentsExtra={},e.total=0,e.perPage=5,e.currentPage=0,e.canManage=a.canManage,e.isGuest=a.isGuest,e.talkpointClosed=a.talkpointClosed,e.timeoutPromise=null,e.nimbbControl={},e.isNimbbVideoPlaying=!1,i.getTalkpoint(a.talkpointid).then(function(n){e.talkpoint=n}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var n=0===e.currentPage?"disabled":"";return n||(n=e.isNimbbVideoPlaying?"disabled":""),n},e.nextPage=function(){e.currentPage<e.pageCount()-1&&e.currentPage++},e.nextPageDisabled=function(){var n=e.currentPage===e.pageCount()-1?"disabled":"";return n||(n=e.isNimbbVideoPlaying?"disabled":""),n},e.pageCount=function(){return 0===e.total?1:Math.ceil(e.total/e.perPage)},e.getPageOfComments=function(t){n.cancel(e.timeoutPromise),o.getPageOfComments(t,e.perPage).then(function(t){e.comments=t.comments,e.total=t.total,e.talkpointClosed=t.talkpointClosed,angular.forEach(e.comments,function(n){angular.isDefined(e.commentsExtra[n.id])&&e.commentsExtra[n.id].speechBubble&&(e.commentsExtra[n.id].speechBubble=n.textcomment)}),e.timeoutPromise=n(function(){e.getPageOfComments(e.currentPage)},1e4)})},e.$watch("currentPage",function(n){e.getPageOfComments(n)}),e.postTextComment=function(n,t){e.textcomment="",e.talkpointClosed=t,o.postTextComment(n,t).then(function(){e.getPageOfComments(e.currentPage)})},e.postNimbbComment=function(n,t){e.talkpointClosed=t,o.postNimbbComment(n,t).then(function(){e.getPageOfComments(e.currentPage)})},e.cancelChanges=function(){},e.startEdit=function(n){angular.isDefined(e.commentsExtra[n.id])||(e.commentsExtra[n.id]={}),e.commentsExtra[n.id].textcomment=n.textcomment,e.commentsExtra[n.id].editing=!0},e.stopEdit=function(n){angular.isDefined(e.commentsExtra[n.id])||(e.commentsExtra[n.id]={}),e.commentsExtra[n.id].textcomment="",e.commentsExtra[n.id].editing=!1},e.putTextComment=function(n){var t=e.commentsExtra[n.id].textcomment;e.commentsExtra[n.id].textcomment="",e.commentsExtra[n.id].editing=!1,o.putTextComment(n.id,t).then(function(t){e.getPageOfComments(e.currentPage),angular.isDefined(e.commentsExtra[n.id])&&e.commentsExtra[n.id].speechBubble&&(e.commentsExtra[n.id].speechBubble=t.textcomment)})},e.deleteComment=function(n){t.confirm(a.messages.confirm)&&o.deleteComment(n).then(function(){e.getPageOfComments(e.currentPage),angular.isDefined(e.commentsExtra[n])&&delete e.commentsExtra[n]})},e.backToTalkpoints=function(){t.location.href=a.baseurl+"/"+a.instanceid},e.openComment=function(t){return angular.isDefined(e.commentsExtra[t.id])||(e.commentsExtra[t.id]={}),e.closeComment(t.id)?void e.getPageOfComments(e.currentPage):(angular.forEach(e.commentsExtra,function(n,i){i!==t.id&&e.closeComment(i)}),void(t.nimbbguidcomment?(e.isNimbbVideoPlaying=!0,n.cancel(e.timeoutPromise),e.commentsExtra[t.id].nimbbGuid=t.nimbbguidcomment):t.textcomment&&(e.commentsExtra[t.id].speechBubble=t.textcomment)))},e.closeComment=function(n,t){return angular.isDefined(e.commentsExtra[n])?e.commentsExtra[n].nimbbGuid?(e.isNimbbVideoPlaying=!1,e.commentsExtra[n].nimbbGuid="",t&&(e.$digest(),e.getPageOfComments(e.currentPage)),!0):e.commentsExtra[n].speechBubble?(e.commentsExtra[n].speechBubble="",!0):!1:!1},t.Nimbb_initCompleted=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_initCompleted)){var t="Nimbb_initCompleted";e.nimbbControl[n][t](n)}},t.Nimbb_recordingStopped=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_recordingStopped)){var t="Nimbb_recordingStopped";e.nimbbControl[n][t](n)}},t.Nimbb_videoSaved=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_videoSaved)){var t="Nimbb_videoSaved";e.nimbbControl[n][t](n)}},t.Nimbb_stateChanged=function(n,t){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_stateChanged)){var i="Nimbb_stateChanged";e.nimbbControl[n][i](n,t)}},t.Nimbb_modeChanged=function(n,t){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_modeChanged)){var i="Nimbb_modeChanged";e.nimbbControl[n][i](n,t)}},t.Nimbb_playbackStopped=function(n,t){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_playbackStopped)){angular.isArray(t)&&(t=t[0]);var i="Nimbb_playbackStopped";e.nimbbControl[n][i](n,t)}}}]),i.controller("talkpointsCtrl",["$scope","$timeout","$window","talkpointsSrv","CONFIG",function(e,n,t,i,o){e.talkpoints=null,e.total=0,e.perPage=5,e.currentPage=0,e.baseurl=o.baseurl,e.canManage=o.canManage,e.isGuest=o.isGuest,e.closed=o.closed,e.timeoutPromise=null,e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.nextPage=function(){e.currentPage<e.pageCount()-1&&e.currentPage++},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()-1?"disabled":""},e.pageCount=function(){return 0===e.total?1:Math.ceil(e.total/e.perPage)},e.getPageOfTalkpoints=function(t){n.cancel(e.timeoutPromise),i.getPageOfTalkpoints(t,e.perPage).then(function(t){e.talkpoints=t.talkpoints,e.total=t.total,e.timeoutPromise=n(function(){e.getPageOfTalkpoints(e.currentPage)},1e4)})},e.$watch("currentPage",function(n){e.getPageOfTalkpoints(n)}),e.addTalkpoint=function(){t.location.href=o.baseurl+"/"+o.instanceid+"/add"},e.editTalkpoint=function(e){t.location.href=o.baseurl+"/"+o.instanceid+"/edit/"+e},e.deleteTalkpoint=function(n){t.confirm(o.messages.confirm)&&i.deleteTalkpoint(n).then(function(){e.getPageOfTalkpoints(e.currentPage)})}}]),i.controller("talkpointsAddEditCtrl",["$scope","$window","CONFIG",function(e,n,t){e.nimbbControl={},e.nimbbguid=t.nimbbguid,e.mediaType=t.mediaType,e.uploadedfile=t.uploadedfile,e.showCurrentRecording=!!e.nimbbguid,e.setButtonLabel=function(){("webcam"===e.mediaType||"audio"===e.mediaType)&&(e.toggleButtonLabel=t.messages[e.mediaType+(e.showCurrentRecording?":recordnew":":showcurrent")])},e.setButtonLabel(),e.saveMedia=function(n){e.nimbbguid=n,e.$broadcast("nimbbchanged",e.nimbbguid),e.$digest()},e.cancelChanges=function(){e.changeMediaType("")},e.toggleCurrentRecording=function(){e.showCurrentRecording=!e.showCurrentRecording,e.setButtonLabel()},e.showConfirmationMessageBeforeChangingMediaType=function(){return t.mediaType?"file"===e.mediaType?"file"===t.mediaType?!!e.uploadedfile&&e.uploadedfile!==t.uploadedfile:!!e.uploadedfile:"webcam"===e.mediaType?"webcam"===t.mediaType?!!e.nimbbguid&&e.nimbbguid!==t.nimbbguid:!!e.nimbbguid:"audio"===e.mediaType?"audio"===t.mediaType?!!e.nimbbguid&&e.nimbbguid!==t.nimbbguid:!!e.nimbbguid:!1:!!e.uploadedfile||!!e.nimbbguid},e.changeMediaType=function(i){var o=e.showConfirmationMessageBeforeChangingMediaType();if(o!==!0&&o!==!1)throw new Error("expected a boolean");return o&&!n.confirm(t.messages[e.mediaType+":confirmlose"])?!1:(e.nimbbguid="",e.uploadedfile="",e.mediaType=i,e.showCurrentRecording=!1,void e.setButtonLabel())},n.Nimbb_initCompleted=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_initCompleted)){var t="Nimbb_initCompleted";e.nimbbControl[n][t](n)}},n.Nimbb_recordingStopped=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_recordingStopped)){var t="Nimbb_recordingStopped";e.nimbbControl[n][t](n)}},n.Nimbb_videoSaved=function(n){if(angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_videoSaved)){var t=["Nimbb_videoSaved"];e.nimbbControl[n][t](n)}},n.Nimbb_stateChanged=function(n,t){if(angular.isArray(t)&&(t=t[0]),angular.isDefined(e.nimbbControl[n])&&angular.isDefined(e.nimbbControl[n].Nimbb_stateChanged)){var i="Nimbb_stateChanged";e.nimbbControl[n][i](n,t),e.toggleButtonDisabled="recording"===t,e.$digest()}}}])},{}],4:[function(e,n,t){"use strict";var i=angular.module("talkpointsApp.directives",[]);i.directive("talkpointListItem",["CONFIG",function(e){return{restrict:"E",scope:{talkpoint:"=",baseurl:"@",canManage:"@",editT:"&",deleteT:"&"},templateUrl:e.baseurl+"/partials/talkpointListItem.twig"}}]),i.directive("jplayer",["CONFIG",function(e){return{restrict:"E",scope:{title:"@"},link:function(n,t,i){var o=angular.element("#jquery_jplayer_1");o.jPlayer({ready:function(){var n={};angular.forEach(i.formats.split(","),function(t){-1!==["m4v","ogv","webmv"].indexOf(t)?n[t]=e.baseurl+"/servevideofile/"+i.talkpointid+"/"+t:n[t]=e.baseurl+"/servefile/"+i.talkpointid}),o.jPlayer("setMedia",n),o.jPlayer("play")},swfPath:e.baseurl+"/js/jplayer",supplied:i.formats,solution:"html, flash",preload:"auto",error:function(e){if("e_no_solution"===e.jPlayer.error.type){var n="This video format is not supported by your browser.";angular.element(".jp-no-solution").html(n)}}})},templateUrl:e.baseurl+"/partials/jplayer.twig"}}]),i.directive("addTextComment",["CONFIG",function(e){return{restrict:"E",scope:{addingTextComment:"=",saveChanges:"&"},link:function(e,n,t){t.$observe("canManage",function(n){e.canManage=e.$eval(n)}),t.$observe("talkpointClosed",function(n){e.talkpointClosed=e.$eval(n)}),e.textcomment=""},templateUrl:e.baseurl+"/partials/addTextComment.twig"}}]),i.directive("addMediaComment",["NIMBB_SWF_URL","NIMBB_PUBLIC_KEY","CONFIG",function(e,n,t){return{restrict:"E",scope:{addingMediaComment:"=",saveChanges:"&",cancelChanges:"&",nimbbControl:"=",mediaType:"="},link:function(i,o,a){a.$observe("canManage",function(e){i.canManage=i.$eval(e)}),a.$observe("talkpointClosed",function(e){i.talkpointClosed=i.$eval(e)}),i.toggleButtonLabel="...",i.toggleButtonDisabled=!0,i.readyToSave=!1,i.unique="nimbb",i.nimbbControl[i.unique]={},i.templateInit=e+"?mode=record&key="+n+"&nologo=1&lang=en&simplepage=1&showmenu=0&showcounter=0",i.$watch("mediaType",function(e){i.init=i.templateInit,i.init+="audio"===e?"&disablecamera=1":"","audio"!==e&&"webcam"!==e||!t.messages[e+":saved"]||(i.init+="&message="+encodeURIComponent(t.messages[e+":saved"]));var n=o.find("object").clone();n.find("embed").attr("src",i.init),n.find("param")[0].value=i.init,o.find("object").replaceWith(n)}),i.nimbbControl[i.unique].Nimbb_initCompleted=function(){i.nimbb=document[i.unique],i.toggleButtonLabel="Start recording",i.toggleButtonDisabled=!1,i.$digest()},i.nimbbControl[i.unique].Nimbb_stateChanged=function(e,n){angular.isArray(n)&&(n=n[0]),"ready"===n?(i.toggleButtonLabel="Start recording",i.toggleButtonDisabled=!1):"recording"===n?(i.toggleButtonLabel="Stop recording",i.toggleButtonDisabled=!1):(i.toggleButtonLabel="...",i.toggleButtonDisabled=!0),i.$digest()},i.nimbbControl[i.unique].Nimbb_videoSaved=function(){i.saveChanges({guid:i.nimbb.getGuid(),finalfeedback:i.finalfeedback}),i.cancel()},i.nimbbControl[i.unique].Nimbb_recordingStopped=function(){i.nimbb.isReadOnly()||(i.readyToSave=!0,i.$digest())},i.toggleRecording=function(){var e=i.nimbb.getState();angular.isArray(e)&&(e=e[0]),"ready"===e?i.nimbb.recordVideo():"recording"===e&&i.nimbb.stopVideo()},i.saveMedia=function(){return i.nimbb.isReadOnly()?void i.cancel():(i.readyToSave=!1,void i.nimbb.saveVideo())},i.cancel=function(){var e=i.nimbb.getState();angular.isArray(e)&&(e=e[0]),"recording"===e&&i.nimbb.stopVideo(),i.toggleButtonLabel="...",i.toggleButtonDisabled=!0,i.readyToSave=!1,i.addingMediaComment=!1},i.shutdown=function(){i.cancel(),i.cancelChanges()}},templateUrl:t.baseurl+"/partials/addMediaComment.twig"}}]),i.directive("playNimbbVideo",["NIMBB_SWF_URL","NIMBB_PUBLIC_KEY","CONFIG","$compile",function(e,n,t,i){var o=function(t,o){t.nimbbGuid&&(t.playerType="flash",t.unique="nimbb_"+t.nimbbGuid,t.nimbbControl[t.unique]={},t.init=e+"?guid="+t.nimbbGuid+"&key="+n+"&autoplay=true&nologo=1&lang=en&simplepage=1&showmenu=1&showcounter=0&bgcolor=000000",t.recompile=function(){var e=o.find("object").clone();e.find("embed").attr({src:t.init,"ng-src":t.init}),e.find("param")[0].value=t.init,i(e)(t),o.find("object").replaceWith(e)},t.isSubject&&setTimeout(function(){t.recompile()},100),t.$on("nimbbchanged",function(e,n){t.nimbbGuid=n,t.init=t.init.replace(/guid=[a-z0-9]+/,"guid="+n),t.recompile(),t.$digest()}),t.nimbbControl[t.unique].Nimbb_playbackStopped=function(e,n){"undefined"!=typeof t.commentid&&n&&t.nimbbComplete({commentid:t.commentid,digest:!0})})},a=function(e){e.nimbbGuid&&(e.playerType="html5",e.init="http://api.nimbb.com/Live/Play.aspx?guid="+e.nimbbGuid+"&key="+n)},r=t.forceHtml5Player||navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?a:o;return{restrict:"E",replace:!0,scope:{commentid:"@",isSubject:"@",nimbbGuid:"@",nimbbControl:"=",nimbbComplete:"&"},link:r,templateUrl:t.baseurl+"/partials/playNimbbVideo.twig"}}]),i.directive("file",function(){return{restrict:"C",link:function(e,n){n.bind("change",function(n){n.target.files[0]&&(e.uploadedfile=n.target.files[0].name,e.$digest())}),e.$watch("uploadedfile",function(){e.uploadedfile||(n[0].value="")})}}})},{}],5:[function(e,n,t){"use strict";var i=angular.module("talkpointsApp.services",[]);i.service("talkpointsSrv",["$http","$q","CONFIG",function(e,n,t){var i=t.baseurl+t.api+"/talkpoint/"+t.instanceid;this.getPageOfTalkpoints=function(t,o){var a=n.defer();return e.get(i+"?limitfrom="+t*o+"&limitnum="+o).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.getTalkpoint=function(t){var o=n.defer();return e.get(i+"/"+t).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.deleteTalkpoint=function(t){var o=n.defer(),a="delete",r=e[a];return r(i+"/"+t).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}]),i.service("commentsSrv",["$http","$q","CONFIG",function(e,n,t){var i=t.baseurl+t.api+"/talkpoint/"+t.instanceid+"/"+t.talkpointid+"/comment";this.getPageOfComments=function(t,o){var a=n.defer();return e.get(i+"?limitfrom="+t*o+"&limitnum="+o).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.postTextComment=function(t,o){var a=n.defer(),r={textcomment:t,finalfeedback:o};return e.post(i,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.postNimbbComment=function(t,o){var a=n.defer(),r={nimbbguidcomment:t,finalfeedback:o};return e.post(i,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.putTextComment=function(t,o){var a=n.defer(),r={textcomment:o};return e.put(i+"/"+t,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.deleteComment=function(t){var o=n.defer(),a="delete",r=e[a];return r(i+"/"+t).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}])},{}]},{},[2]);