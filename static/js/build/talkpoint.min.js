!function e(t,n,i){function o(r,l){if(!n[r]){if(!t[r]){var m="function"==typeof require&&require;if(!l&&m)return m(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var s=n[r]={exports:{}};t[r][0].call(s.exports,function(e){var n=t[r][1][e];return o(n?n:e)},s,s.exports,e,t,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(e,t,n){"use strict";var i=angular.module("talkpointsApp",["talkpointsApp.controllers","talkpointsApp.services","talkpointsApp.directives","ngSanitize"]);i.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://player.nimbb.com/**","https://player.nimbb.com/**","http://api.nimbb.com/**","https://api.nimbb.com/**"])}]),i.constant("NIMBB_PUBLIC_KEY","c7d8097faa"),i.constant("NIMBB_SWF_URL","https://player.nimbb.com/nimbb.swf"),i.constant("CONFIG",window.CONFIG),delete window.CONFIG},{}],2:[function(e,t,n){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("./services")},{"./angular-app":1,"./controllers":3,"./directives":4,"./services":5}],3:[function(e,t,n){"use strict";var i=angular.module("talkpointsApp.controllers",[]);i.controller("talkpointCtrl",["$scope","$timeout","$window","talkpointsSrv","commentsSrv","CONFIG",function(e,t,n,i,o,a){e.talkpoint=null,e.comments=null,e.commentsExtra={},e.total=0,e.perPage=5,e.currentPage=0,e.canManage=a.canManage,e.isGuest=a.isGuest,e.talkpointClosed=a.talkpointClosed,e.timeoutPromise=null,e.nimbbControl={},e.isNimbbVideoPlaying=!1,i.getTalkpoint(a.talkpointid).then(function(t){e.talkpoint=t}),e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){var t=0===e.currentPage?"disabled":"";return t||(t=e.isNimbbVideoPlaying?"disabled":""),t},e.nextPage=function(){e.currentPage<e.pageCount()-1&&e.currentPage++},e.nextPageDisabled=function(){var t=e.currentPage===e.pageCount()-1?"disabled":"";return t||(t=e.isNimbbVideoPlaying?"disabled":""),t},e.pageCount=function(){return 0===e.total?1:Math.ceil(e.total/e.perPage)},e.getPageOfComments=function(n){t.cancel(e.timeoutPromise),o.getPageOfComments(n,e.perPage).then(function(n){e.comments=n.comments,e.total=n.total,e.talkpointClosed=n.talkpointClosed,angular.forEach(e.comments,function(t){angular.isDefined(e.commentsExtra[t.id])&&e.commentsExtra[t.id].speechBubble&&(e.commentsExtra[t.id].speechBubble=t.textcomment)}),e.timeoutPromise=t(function(){e.getPageOfComments(e.currentPage)},1e4)})},e.$watch("currentPage",function(t){e.getPageOfComments(t)}),e.postTextComment=function(t,n){e.textcomment="",e.talkpointClosed=n,o.postTextComment(t,n).then(function(){e.getPageOfComments(e.currentPage)})},e.postNimbbComment=function(t,n){e.talkpointClosed=n,o.postNimbbComment(t,n).then(function(){e.getPageOfComments(e.currentPage)})},e.cancelChanges=function(){},e.startEdit=function(t){angular.isDefined(e.commentsExtra[t.id])||(e.commentsExtra[t.id]={}),e.commentsExtra[t.id].textcomment=t.textcomment,e.commentsExtra[t.id].editing=!0},e.stopEdit=function(t){angular.isDefined(e.commentsExtra[t.id])||(e.commentsExtra[t.id]={}),e.commentsExtra[t.id].textcomment="",e.commentsExtra[t.id].editing=!1},e.putTextComment=function(t){var n=e.commentsExtra[t.id].textcomment;e.commentsExtra[t.id].textcomment="",e.commentsExtra[t.id].editing=!1,o.putTextComment(t.id,n).then(function(n){e.getPageOfComments(e.currentPage),angular.isDefined(e.commentsExtra[t.id])&&e.commentsExtra[t.id].speechBubble&&(e.commentsExtra[t.id].speechBubble=n.textcomment)})},e.deleteComment=function(t){n.confirm(a.messages.confirm)&&o.deleteComment(t).then(function(){e.getPageOfComments(e.currentPage),angular.isDefined(e.commentsExtra[t])&&delete e.commentsExtra[t]})},e.backToTalkpoints=function(){n.location.href=a.baseurl+"/"+a.instanceid},e.openComment=function(n){return angular.isDefined(e.commentsExtra[n.id])||(e.commentsExtra[n.id]={}),e.closeComment(n.id)?void e.getPageOfComments(e.currentPage):(angular.forEach(e.commentsExtra,function(t,i){i!==n.id&&e.closeComment(i)}),void(n.nimbbguidcomment?(e.isNimbbVideoPlaying=!0,t.cancel(e.timeoutPromise),e.commentsExtra[n.id].nimbbGuid=n.nimbbguidcomment):n.textcomment&&(e.commentsExtra[n.id].speechBubble=n.textcomment)))},e.closeComment=function(t,n){return angular.isDefined(e.commentsExtra[t])?e.commentsExtra[t].nimbbGuid?(e.isNimbbVideoPlaying=!1,e.commentsExtra[t].nimbbGuid="",n&&(e.$digest(),e.getPageOfComments(e.currentPage)),!0):e.commentsExtra[t].speechBubble?(e.commentsExtra[t].speechBubble="",!0):!1:!1},n.Nimbb_initCompleted=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_initCompleted)){var n="Nimbb_initCompleted";e.nimbbControl[t][n](t)}},n.Nimbb_recordingStopped=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_recordingStopped)){var n="Nimbb_recordingStopped";e.nimbbControl[t][n](t)}},n.Nimbb_videoSaved=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_videoSaved)){var n="Nimbb_videoSaved";e.nimbbControl[t][n](t)}},n.Nimbb_stateChanged=function(t,n){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_stateChanged)){var i="Nimbb_stateChanged";e.nimbbControl[t][i](t,n)}},n.Nimbb_modeChanged=function(t,n){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_modeChanged)){var i="Nimbb_modeChanged";e.nimbbControl[t][i](t,n)}},n.Nimbb_playbackStopped=function(t,n){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_playbackStopped)){angular.isArray(n)&&(n=n[0]);var i="Nimbb_playbackStopped";e.nimbbControl[t][i](t,n)}}}]),i.controller("talkpointsCtrl",["$scope","$timeout","$window","talkpointsSrv","CONFIG",function(e,t,n,i,o){e.talkpoints=null,e.total=0,e.perPage=5,e.currentPage=0,e.baseurl=o.baseurl,e.canManage=o.canManage,e.isGuest=o.isGuest,e.closed=o.closed,e.timeoutPromise=null,e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.nextPage=function(){e.currentPage<e.pageCount()-1&&e.currentPage++},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()-1?"disabled":""},e.pageCount=function(){return 0===e.total?1:Math.ceil(e.total/e.perPage)},e.getPageOfTalkpoints=function(n){t.cancel(e.timeoutPromise),i.getPageOfTalkpoints(n,e.perPage).then(function(n){e.talkpoints=n.talkpoints,e.total=n.total,e.timeoutPromise=t(function(){e.getPageOfTalkpoints(e.currentPage)},1e4)})},e.$watch("currentPage",function(t){e.getPageOfTalkpoints(t)}),e.addTalkpoint=function(){n.location.href=o.baseurl+"/"+o.instanceid+"/add"},e.editTalkpoint=function(e){n.location.href=o.baseurl+"/"+o.instanceid+"/edit/"+e},e.deleteTalkpoint=function(t){n.confirm(o.messages.confirm)&&i.deleteTalkpoint(t).then(function(){e.getPageOfTalkpoints(e.currentPage)})}}]),i.controller("talkpointsAddEditCtrl",["$scope","$window","CONFIG",function(e,t,n){e.nimbbControl={},e.nimbbguid=n.nimbbguid,e.mediaType=n.mediaType,e.uploadedfile=n.uploadedfile,e.showCurrentRecording=!!e.nimbbguid,e.setButtonLabel=function(){("webcam"===e.mediaType||"audio"===e.mediaType)&&(e.toggleButtonLabel=n.messages[e.mediaType+(e.showCurrentRecording?":recordnew":":showcurrent")])},e.setButtonLabel(),e.saveMedia=function(t){e.nimbbguid=t,e.$broadcast("nimbbchanged",e.nimbbguid),e.$digest()},e.cancelChanges=function(){e.changeMediaType("")},e.toggleCurrentRecording=function(){e.showCurrentRecording=!e.showCurrentRecording,e.setButtonLabel()},e.changeMediaType=function(i){return e.mediaType&&(e.nimbbguid||e.uploadedfile)&&!t.confirm(n.messages.confirmdeletefile)?!1:(e.nimbbguid="",e.uploadedfile="",e.mediaType=i,e.showCurrentRecording=!1,void e.setButtonLabel())},t.Nimbb_initCompleted=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_initCompleted)){var n="Nimbb_initCompleted";e.nimbbControl[t][n](t)}},t.Nimbb_recordingStopped=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_recordingStopped)){var n="Nimbb_recordingStopped";e.nimbbControl[t][n](t)}},t.Nimbb_videoSaved=function(t){if(angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_videoSaved)){var n=["Nimbb_videoSaved"];e.nimbbControl[t][n](t)}},t.Nimbb_stateChanged=function(t,n){if(angular.isArray(n)&&(n=n[0]),angular.isDefined(e.nimbbControl[t])&&angular.isDefined(e.nimbbControl[t].Nimbb_stateChanged)){var i="Nimbb_stateChanged";e.nimbbControl[t][i](t,n),e.toggleButtonDisabled="recording"===n,e.$digest()}}}])},{}],4:[function(e,t,n){"use strict";var i=angular.module("talkpointsApp.directives",[]);i.directive("talkpointListItem",["CONFIG",function(e){return{restrict:"E",scope:{talkpoint:"=",baseurl:"@",canManage:"@",editT:"&",deleteT:"&"},templateUrl:e.baseurl+"/partials/talkpointListItem.twig"}}]),i.directive("jplayer",["CONFIG",function(e){return{restrict:"E",scope:{title:"@"},link:function(t,n,i){var o=angular.element("#jquery_jplayer_1");o.jPlayer({ready:function(){var t={};angular.forEach(i.formats.split(","),function(n){t[n]=-1!==["m4v","ogv","webmv"].indexOf(n)?e.baseurl+"/servevideofile/"+i.talkpointid+"/"+n:e.baseurl+"/servefile/"+i.talkpointid}),o.jPlayer("setMedia",t),o.jPlayer("play")},swfPath:e.baseurl+"/js/jplayer",supplied:i.formats,solution:"html, flash",preload:"auto",error:function(e){if("e_no_solution"===e.jPlayer.error.type){var t="This video format is not supported by your browser.";angular.element(".jp-no-solution").html(t)}}})},templateUrl:e.baseurl+"/partials/jplayer.twig"}}]),i.directive("addTextComment",["CONFIG",function(e){return{restrict:"E",scope:{addingTextComment:"=",saveChanges:"&"},link:function(e,t,n){n.$observe("canManage",function(t){e.canManage=e.$eval(t)}),n.$observe("talkpointClosed",function(t){e.talkpointClosed=e.$eval(t)}),e.textcomment=""},templateUrl:e.baseurl+"/partials/addTextComment.twig"}}]),i.directive("addMediaComment",["NIMBB_SWF_URL","NIMBB_PUBLIC_KEY","CONFIG",function(e,t,n){return{restrict:"E",scope:{addingMediaComment:"=",saveChanges:"&",cancelChanges:"&",nimbbControl:"=",mediaType:"="},link:function(i,o,a){a.$observe("canManage",function(e){i.canManage=i.$eval(e)}),a.$observe("talkpointClosed",function(e){i.talkpointClosed=i.$eval(e)}),i.toggleButtonLabel="...",i.toggleButtonDisabled=!0,i.readyToSave=!1,i.unique="nimbb",i.nimbbControl[i.unique]={},i.templateInit=e+"?mode=record&key="+t+"&nologo=1&lang=en&simplepage=1&showmenu=0&showcounter=0",i.$watch("mediaType",function(e){i.init=i.templateInit,i.init+="audio"===e?"&disablecamera=1":"","audio"!==e&&"webcam"!==e||!n.messages[e+":saved"]||(i.init+="&message="+encodeURIComponent(n.messages[e+":saved"]));var t=o.find("object").clone();t.find("embed").attr("src",i.init),t.find("param")[0].value=i.init,o.find("object").replaceWith(t)}),i.nimbbControl[i.unique].Nimbb_initCompleted=function(){i.nimbb=document[i.unique],i.toggleButtonLabel="Start recording",i.toggleButtonDisabled=!1,i.$digest()},i.nimbbControl[i.unique].Nimbb_stateChanged=function(e,t){angular.isArray(t)&&(t=t[0]),"ready"===t?(i.toggleButtonLabel="Start recording",i.toggleButtonDisabled=!1):"recording"===t?(i.toggleButtonLabel="Stop recording",i.toggleButtonDisabled=!1):(i.toggleButtonLabel="...",i.toggleButtonDisabled=!0),i.$digest()},i.nimbbControl[i.unique].Nimbb_videoSaved=function(){i.saveChanges({guid:i.nimbb.getGuid(),finalfeedback:i.finalfeedback}),i.cancel()},i.nimbbControl[i.unique].Nimbb_recordingStopped=function(){i.nimbb.isReadOnly()||(i.readyToSave=!0,i.$digest())},i.toggleRecording=function(){var e=i.nimbb.getState();angular.isArray(e)&&(e=e[0]),"ready"===e?i.nimbb.recordVideo():"recording"===e&&i.nimbb.stopVideo()},i.saveMedia=function(){return i.nimbb.isReadOnly()?void i.cancel():(i.readyToSave=!1,void i.nimbb.saveVideo())},i.cancel=function(){var e=i.nimbb.getState();angular.isArray(e)&&(e=e[0]),"recording"===e&&i.nimbb.stopVideo(),i.toggleButtonLabel="...",i.toggleButtonDisabled=!0,i.readyToSave=!1,i.addingMediaComment=!1},i.shutdown=function(){i.cancel(),i.cancelChanges()}},templateUrl:n.baseurl+"/partials/addMediaComment.twig"}}]),i.directive("playNimbbVideo",["NIMBB_SWF_URL","NIMBB_PUBLIC_KEY","CONFIG","$compile",function(e,t,n,i){var o=function(n,o){n.nimbbGuid&&(n.playerType="flash",n.unique="nimbb_"+n.nimbbGuid,n.nimbbControl[n.unique]={},n.init=e+"?guid="+n.nimbbGuid+"&key="+t+"&autoplay=true&nologo=1&lang=en&simplepage=1&showmenu=1&showcounter=0&bgcolor=000000",n.recompile=function(){var e=o.find("object").clone();e.find("embed").attr({src:n.init,"ng-src":n.init}),e.find("param")[0].value=n.init,i(e)(n),o.find("object").replaceWith(e)},n.isSubject&&setTimeout(function(){n.recompile()},100),n.$on("nimbbchanged",function(e,t){n.nimbbGuid=t,n.init=n.init.replace(/guid=[a-z0-9]+/,"guid="+t),n.recompile(),n.$digest()}),n.nimbbControl[n.unique].Nimbb_playbackStopped=function(e,t){"undefined"!=typeof n.commentid&&t&&n.nimbbComplete({commentid:n.commentid,digest:!0})})},a=function(e){e.nimbbGuid&&(e.playerType="html5",e.init="http://api.nimbb.com/Live/Play.aspx?guid="+e.nimbbGuid+"&key="+t)},r=n.forceHtml5Player||navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?a:o;return{restrict:"E",replace:!0,scope:{commentid:"@",isSubject:"@",nimbbGuid:"@",nimbbControl:"=",nimbbComplete:"&"},link:r,templateUrl:n.baseurl+"/partials/playNimbbVideo.twig"}}]),i.directive("file",function(){return{restrict:"C",link:function(e,t){t.bind("change",function(t){t.target.files[0]&&(e.uploadedfile=t.target.files[0].name,e.$digest())}),e.$watch("uploadedfile",function(){e.uploadedfile||(t[0].value="")})}}})},{}],5:[function(e,t,n){"use strict";var i=angular.module("talkpointsApp.services",[]);i.service("talkpointsSrv",["$http","$q","CONFIG",function(e,t,n){var i=n.baseurl+n.api+"/talkpoint/"+n.instanceid;this.getPageOfTalkpoints=function(n,o){var a=t.defer();return e.get(i+"?limitfrom="+n*o+"&limitnum="+o).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.getTalkpoint=function(n){var o=t.defer();return e.get(i+"/"+n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.deleteTalkpoint=function(n){var o=t.defer(),a="delete",r=e[a];return r(i+"/"+n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}]),i.service("commentsSrv",["$http","$q","CONFIG",function(e,t,n){var i=n.baseurl+n.api+"/talkpoint/"+n.instanceid+"/"+n.talkpointid+"/comment";this.getPageOfComments=function(n,o){var a=t.defer();return e.get(i+"?limitfrom="+n*o+"&limitnum="+o).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.postTextComment=function(n,o){var a=t.defer(),r={textcomment:n,finalfeedback:o};return e.post(i,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.postNimbbComment=function(n,o){var a=t.defer(),r={nimbbguidcomment:n,finalfeedback:o};return e.post(i,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.putTextComment=function(n,o){var a=t.defer(),r={textcomment:o};return e.put(i+"/"+n,r).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},this.deleteComment=function(n){var o=t.defer(),a="delete",r=e[a];return r(i+"/"+n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise}}])},{}]},{},[2]);